10 REM ™™™†‘»≈†«“≈¡‘†Õœ÷…≈†√¡“‘œœŒ†™™™õ20 REM †††††††††††††††††≈¯·ÌÏÂ†±¥††††õ30 REM õ40 REM Program putting it all together - PM Graphics, Fine Scrolling, & Display List Interruptsõ50 REM Copyright (C) 1982 by David Fox and Mitchell Waiteõ60 REM õ70 GOTO 140õ80 REM õ100 REM »ÈØÃÔ†¬˘ÙÂ†√·Ï„ıÏ·ÙÈÔÓõ110 HIBYTE=INT(X/256):REM Calculate High Byteõ120 LOBYTE=X-HIBYTE*256:REM Calculate Low Byteõ130 RETURN õ140 REM …ÓÈÙÈ·ÏÈ˙Âõ150 DIM PLR(3),HPLR(3),VPLR(3),RATE(3),PMWIDTH(3),FRMLSTPTR(3),MOVERATE(3)õ160 DIM CL$(24),SEG$(24),TEMP$(8)õ170 CL$(1)=CHR$(0):CL$(24)=CHR$(0):CL$(2)=CL$:REM Fill with ASCII 0õ180 GOSUB 11000:REM Initialize Routine stringsõ190 GOSUB 5000:REM Set up memory locationsõ200 GOSUB 6000:REM Set up Display Listõ210 GOSUB 2600:REM Clear screenõ220 GOSUB 7000:REM Set up Player areaõ230 GOSUB 8000:REM Load in Character Setõ240 GOSUB 10000:REM Read frames into RAMõ250 POKE 756,HICHRB:REM Switch to Street character setõ260 POKE 559,47:REM Turn screen DMA on again, Wide Playfield, PM 2 line resolution, Players enabledõ270 GOSUB 2800:GOSUB 3000:REM Create a streetõ280 GOSUB 12000:REM Set up parameter addressesõ290 GOSUB 13000:REM Turn on interruptsõ310 FOR I=0 TO 1:POKE RATE(I),4:NEXT I:REM Frame rate for walking manõ320 SPEED=-1:REM Temporary start up conditionõ330 GOSUB 1000:GOSUB 1100õ340 SPEED=1õ350 TEMP=USR(PMOVER,ALLP)õ360 POKE INITANIMATE,ALLPõ370 GOSUB 700õ380 OPEN #2,4,0,"K:":POKE 754,255õ390 REM õ400 REM Õ·ÈÓ†¡ÓÈÌ·ÙÈÔÓ†ÃÔÔõ410 TEMP=ABS(PEEK(1064)-128):SND=TEMP/5:SND2=SND+SCONSõ420 IF VF THEN VOL=(128-TEMP)/9:SOUND 1,SND,8,VOL:SOUND 2,SND2,2,VOLõ430 IF WALK>0 THEN WALK=WALK-(SPEED<>1):GOTO 470õ440 IF WALK=0 THEN POKE INITAUTOMOVE,FST2P:TEMP=USR(PMOVER,FST2P):WALK=-1õ450 IF PEEK(1086)=2 THEN SOUND 0,10,4,10:SOUND 0,0,0,0:REM Footstepsõ460 IF PEEK(1062)>218 OR PEEK(1062)<20 THEN GOSUB 1050:REM Reset Manõ470 IF PEEK(1064)>229 OR PEEK(1065)<16 THEN GOSUB 600:REM Reset other playersõ480 IF PEEK(754)=255 THEN 410õ490 GET #2,BYTE:SPEED=BYTE-48:POKE 754,255:IF SPEED<0 THEN SPEED=0õ510 GOSUB 700õ520 GOTO 410õ530 REM õ600 REM ”ÂÏÂ„Ù†·†ŒÂ˜†œ‚ÍÂ„Ùõ610 IF VOL THEN VOL=INT(VOL):IF VOL=0 THEN VOL=1õ620 IF VOL THEN VOL=VOL-0.5:SOUND 1,SND,8,VOL:SOUND 2,SND2,2,VOL:GOTO 620õ630 TEMP=USR(MFILL,PLR(2),256,0):REM Use memory fill routine to clear Players 2 & 3õ640 FLAG=INT(RND(1)*6+1):REM Which object to display (if possible)õ650 OBJECT=0:REM No object selected yetõ660 ON FLAG GOSUB 1100,1100,1100,1200,1300,1300:IF OBJECT=0 THEN RETURN õ670 TEMP=USR(PMOVER,LST2P)õ680 POKE INITANIMATE,LST2Põ690 REM õ700 REM ”ÂÙ†»ÔÚÈ˙ÔÓÙ·Ï†÷ÂÏÔ„ÈÙÈÂÛõ710 IF OBJECT=3 THEN NSPD=128-SPEED*2:GOTO 740:REM Treeõ720 IF OBJECT=4 THEN NSPD=125-SPEED:GOTO 740:REM Truckõ730 NSPD=132-SPEED:REM Carõ740 POKE MOVERATE(2),NSPD:POKE MOVERATE(3),NSPD:TEMP=LST2Põ750 POKE MOVERATE(0),129-SPEED:POKE MOVERATE(1),129-SPEED:IF WALK=-1 THEN TEMP=ALLPõ760 POKE INITAUTOMOVE,TEMPõ770 POKE SCRLSTEP,SPEEDõ780 RETURN õ790 REM õ1000 REM –¡“¡Õ≈‘≈“”†∆œ“†–Ã¡Ÿ≈“”õ1010 REM Õ·Óõ1020 POKE 704,3*16+10:POKE 705,3*16+10:REM Set color to peachõ1030 FRSTPLR=0:OBJECT=1:GOSUB 1500:REM Point to proper Frame Listõ1040 POKE VPLR(0),97:POKE VPLR(1),97õ1050 IF SPEED=1 THEN 1070õ1060 POKE HPLR(0),20:POKE HPLR(1),28:IF SPEED>1 THEN POKE HPLR(0),218:POKE HPLR(1),226õ1070 WALK=INT(RND(1)*100+20)õ1080 RETURN õ1090 REM õ1100 REM ‘ÚÂÂõ1110 IF SPEED=0 THEN RETURN õ1120 POKE 706,14*16+4:POKE 707,13*16+6:REM Brown trunk and green leavesõ1130 POKE HPLR(2),229:POKE HPLR(3),217õ1140 POKE VPLR(2),42:POKE VPLR(3),28õ1150 FRSTPLR=2:OBJECT=2:GOSUB 1500:FRSTPLR=3:OBJECT=3:GOSUB 1500:REM Point to proper Frame Listõ1160 POKE PMWIDTH(2),0:POKE PMWIDTH(3),3õ1170 VF=0õ1180 RETURN õ1190 REM õ1200 REM ‘Úı„Îõ1210 POKE 706,3*16+6:POKE 707,INT(RND(1)*16)*16+10õ1220 POKE HPLR(2),217:POKE HPLR(3),233õ1230 POKE VPLR(2),77:POKE VPLR(3),77õ1240 FRSTPLR=2:OBJECT=4:GOSUB 1500:REM Point to proper Frame Listõ1250 POKE PMWIDTH(2),1:POKE PMWIDTH(3),3õ1260 VF=1:SCONS=180õ1270 RETURN õ1280 REM õ1300 REM √·Úõ1310 IF SPEED=4 THEN RETURN õ1320 C=INT(RND(1)*16):L=8-INT(RND(1)*2)*4:TEMP=C*16+L:POKE 706,TEMP:POKE 707,TEMPõ1330 POKE HPLR(2),0:POKE HPLR(3),16õ1340 IF SPEED>4 THEN POKE HPLR(2),216:POKE HPLR(3),232õ1350 POKE VPLR(2),96:POKE VPLR(3),96õ1360 FRSTPLR=2:OBJECT=5:GOSUB 1500:REM Point to proper Frame Listõ1370 POKE PMWIDTH(2),1:POKE PMWIDTH(3),1õ1380 VF=1:SCONS=40õ1390 RETURN õ1400 REM õ1500 REM –ıÙ†∆Ú·ÌÂ†ÃÈÛÙ†¡‰‰ÚÂÛÛ†ÈÓ†–·Ú·Ì†‘·‚ÏÂõ1510 FOR I=0 TO NUMPLRS(OBJECT)-1õ1520   X=POINTER(OBJECT,I):GOSUB 110õ1530   POKE FRMLSTPTR(I+FRSTPLR),LOBYTEõ1540   POKE FRMLSTPTR(I+FRSTPLR)+1,HIBYTEõ1550 NEXT Iõ1560 RETURN õ1570 REM õ1900 REM √ÔÓˆÂÚÙ†ÙÔ†”„ÚÂÂÓ†÷·ÏıÂõ1910 CFLAG=0õ1920 IF CHAR>127 THEN CHAR=CHAR-128:CFLAG=128õ1930 IF CHAR<96 THEN CHAR=CHAR-32:IF CHAR<0 THEN CHAR=CHAR+96õ1940 IF CFLAG THEN CHAR=CHAR+CFLAG+PAINT*64õ1950 RETURN õ1960 REM õ2000 REM ”ÂÓ‰†…ÓÊÔ†ÙÔ†”„ÚÂÂÓõ2010 LN=LEN(SEG$):IF LN<24 THEN SEG$(LN+1)=CL$õ2020 IF FENCE THEN PTR=PTR+1õ2030 FOR I=0 TO HEIGHTõ2040   IF FENCE THEN GOSUB 2200õ2050   FOR J=1 TO WIDTHõ2060     P=I*WIDTH+J:CHAR=ASC(SEG$(P,P))õ2070     GOSUB 1900õ2080     IF GRND THEN POKE SCRLWIN+6*LINELEN+J+23,CHAR:GOTO 2130õ2090     IF CLOUD=0 THEN 2120õ2100     IF CLOUD=2 THEN CHAR=CHAR+64õ2110     POKE SCRN+PTR+I*24+J-1,CHAR:GOTO 2130õ2120     POKE SCRLWIN+PTR+I*LINELEN+J-1,CHARõ2130   NEXT Jõ2140 NEXT Iõ2150 PTR=PTR+WIDTH+ABS(FENCE)+SPCFLAGõ2160 SPCFLAG=0õ2170 ROOMLEFT=LINELEN-25-PTRõ2180 RETURN õ2190 REM õ2200 REM –ıÙ†…Ó†∆ÂÓ„Âõ2210 IF I<4 THEN 2240õ2220 IF I=4 THEN CHAR=ASC("Q"):GOSUB 1900:P=-1:GOSUB 2250:CHAR=ASC("E"):GOSUB 1900:P=WIDTH:GOSUB 2250:GOTO 2240õ2230 CHAR=ASC("A"):GOSUB 1900:P=-1:GOSUB 2250:CHAR=ASC("D"):GOSUB 1900:P=WIDTH:GOSUB 2250õ2240 RETURN õ2250 REM –ÔÎÂ†…Ó†ƒ·Ù·õ2260 POKE SCRLWIN+PTR+I*LINELEN+P,CHARõ2270 RETURN õ2280 REM õ2400 REM √Ô˘†∆ÈÚÛÙ†–·ÁÂ†œÓÙÔ†Ã·ÛÙ†–·ÁÂõ2410 FOR I=0 TO 5õ2420   FOR J=0 TO 24õ2430     POKE SCRLWIN+I*LINELEN+LINELEN-25+J,PEEK(SCRLWIN+I*LINELEN+J)õ2440   NEXT Jõ2450 NEXT Iõ2460 RETURN õ2470 REM õ2600 REM √ÏÂ·Ú†ÙËÂ†”„ÚÂÂÓ†≠†∆ÈÏÏ†ÙËÂ†”„ÚÂÂÓ†◊ÈÙË†∞õ2610 TEMP=USR(MFILL,SCRN,SCRNSZE,0)õ2620 RETURN õ2630 REM õ2800 REM –ıÙ†ÈÓ†√ÏÔı‰Û†·Ó‰†”È‰Â˜·ÏÎõ2810 SEG$="º‘Ωº‘‘Ω€‹›€‹‹›":CLOUD=1:PTR=4:HEIGHT=1:WIDTH=7:GOSUB 2000õ2820 SEG$="º‘ΩºΩ€‹‹‹›":CLOUD=2:PTR=PTR+3:WIDTH=5:GOSUB 2000õ2830 SEG$="ﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁﬁ":GRND=1:HEIGHT=0:WIDTH=24:GOSUB 2000õ2840 RETURN õ2850 REM õ2995 REM õ3000 REM √“≈¡‘≈†“¡ŒƒœÕ†ƒ…”–Ã¡Ÿõ3010 PTR=0:REM Initialize Pointer to Scroll Windowõ3020 HEIGHT=5:REM How tall is the windowõ3030 CLOUD=0:GRND=0õ3040 WIDTH=INT(RND(1)*3+2):REM From 2-4õ3050 IF RND(1)*100<=45 THEN STORY=2:GOTO 3080:REM 45% 2 Storiesõ3060 IF RND(1)*55<=35 THEN STORY=3:GOTO 3080:REM 35% 3 Storiesõ3070 STORY=4:REM 20% 4 Storiesõ3080 CHIMNEY=(RND(1)<=0.6):REM 60% chanceõ3090 IF SHRUB=0 THEN FENCE=(RND(1)<=0.4):REM 40% chance (only if no shrub)õ3100 IF ROOMLEFT<6 THEN FENCE=0:REM Not enough room left for a fenceõ3110 ANTENNA=(RND(1)<=0.5):REM 50% chanceõ3120 PAINT=(RND(1)<=0.5):REM 50% yellow, 50% pinkõ3130 SEG$=CL$:ON WIDTH-1 GOSUB 3500,3700,3900:GOSUB 2000õ3140 IF ROOMLEFT<2 THEN GOSUB 2400:RETURN :REM No room for tree, exit routineõ3150 REM –Ï·ÓÙ†”ÔÌÂ†∆ÔÈÏ·ÁÂõ3160 SHRUB=0:TREE=0õ3170 IF FENCE=0 AND ODDHOUSE=0 AND ROOMLEFT>8 THEN SHRUB=(RND(1)<=0.3):IF SHRUB THEN 3440õ3180 REM Õ·ÎÂ†·†ÙÚÂÂõ3190 WIDTH=2:SEG$=CL$õ3200 REM Find height of treeõ3210 IF RND(1)*10<=1 THEN TREE=2:GOTO 3260:REM 10%õ3220 IF RND(1)*9<=2 THEN TREE=3:GOTO 3260:REM 20%õ3230 IF RND(1)*7<=4 THEN TREE=4:GOTO 3260:REM 40%õ3240 IF RND(1)*3<=2 THEN TREE=5:GOTO 3260:REM 20%õ3250 TREE=6:REM 10%õ3260 TRUNK=INT(RND(1)*(TREE-2)+1):IF TREE=2 THEN TRUNK=0õ3270 TREETOP=TREE-TRUNK:IF TREETOP>4 THEN TRUNK=TREE-4:TREETOP=4õ3280 BT=(6-TREE)*2+1õ3290 SEG$(BT)=""õ3300 IF TREETOP=2 THEN 3340õ3310 FOR I=1 TO TREETOP-2õ3320   BT=BT+2:SEG$(BT)="tt"õ3330 NEXT Iõ3340 BT=BT+2:SEG$(BT)=""õ3350 IF TRUNK=1 THEN 3390õ3360 FOR I=1 TO TRUNK-1õ3370   BT=BT+2:SEG$(BT)="BV"õ3380 NEXT Iõ3390 IF RND(1)<=0.5 THEN SEG$(BT+2)="KL"õ3400 REM Add random spacing on side of treeõ3410 TEMP=INT(RND(1)*3+1):IF TEMP=3 OR ROOMLEFT<3 THEN 3470õ3420 IF TEMP=1 THEN PTR=PTR+1:GOTO 3470õ3430 SPCFLAG=1:GOTO 3470õ3440 REM Õ·ÎÂ†·†ÛËÚı‚õ3450 WIDTH=INT(RND(1)*2+2):SEG$=CL$:IF WIDTH=2 THEN SEG$(9)="":GOTO 3470õ3460 SEG$(13)=" "õ3470 ODDHOUSE=0:FENCE=0:GOSUB 2000õ3480 IF ROOMLEFT<4 THEN 3140:REM Add another tree if not enough room for a houseõ3490 GOTO 3040õ3500 REM ◊È‰ÙË†≤õ3510 IF STORY>3 THEN STORY=3õ3520 BT=1õ3530 IF STORY=2 THEN BT=3õ3540 IF CHIMNEY THEN SEG$(BT)="INZU":GOTO 3560õ3550 SEG$(BT)="IOZX"õ3560 BT=BT+4:FOR I=BT TO BT+(STORY-2)*2 STEP 2õ3570   IF RND(1)<=0.5 THEN SEG$(I)="‘–":GOTO 3590õ3580   SEG$(I)="“–"õ3590 NEXT Iõ3600 SEG$(9)="√‘"õ3610 IF FENCE=0 THEN 3640õ3620 IF RND(1)<=0.5 THEN SEG$(11)="WW":GOTO 3640õ3630 SEG$(11)="EQ"õ3640 RETURN õ3650 REM õ3700 REM ◊È‰ÙË†≥õ3710 BT=(4-STORY)*3+1õ3720 IF ANTENNA AND STORY<4 THEN SEG$(BT-3)=" ` "õ3730 SEG$(BT)="ZTX"õ3740 IF RND(1)<=0.5 THEN TEMP$="∆–«":GOTO 3760õ3750 TEMP$="∆“«"õ3760 BT=BT+3:FOR I=BT TO BT+(STORY-2)*3 STEP 3õ3770   SEG$(I)=TEMP$õ3780 NEXT Iõ3790 SEG$(13)="∆√«"õ3800 IF FENCE THEN SEG$(16)="WWW"õ3810 RETURN õ3820 REM õ3900 REM ◊È‰ÙË†¥õ3910 BT=(4-STORY)*4+1õ3920 IF STORY=4 THEN SEG$(BT)="HTTJ":GOTO 4050õ3930 IF STORY>2 OR SHRUB OR RND(1)<=0.3333 THEN 4000:REM Which type house?õ3940 REM Create Odd House typeõ3950 ODDHOUSE=1õ3960 IF CHIMNEY THEN SEG$(1)=" IN  ZU ":GOTO 3980õ3970 SEG$(1)=" IO  ZX "õ3980 FENCE=0õ3990 SEG$(9)="ITTO¬“–÷¬‘√÷":GOTO 4100õ4000 REM Create Normal House typeõ4010 IF ANTENNA AND CHIMNEY THEN SEG$(BT-4)="`HJ YTTJ":GOTO 4050õ4020 SEG$(BT-4)=" HJ ":IF CHIMNEY=0 THEN SEG$(BT)="HTTJ":GOTO 4050õ4030 IF RND(1)<=0.5 THEN SEG$(BT)="YTTJ":GOTO 4050õ4040 SEG$(BT)="HTTM"õ4050 BT=BT+4:FOR I=BT TO BT+(STORY-2)*4 STEP 4õ4060   IF RND(1)<=0.25 THEN SEG$(I)="∆””«":GOTO 4080õ4070   SEG$(I)="∆–“«"õ4080 NEXT Iõ4090 SEG$(17)="∆‘√«"õ4100 IF FENCE THEN SEG$(21)="WEQW"õ4110 RETURN õ4120 REM õ4125 REM õ5000 REM ”ÂÙ†’†ÕÂÌÔÚ˘†ÃÔ„·ÙÈÔÓÛõ5010 DIF=0õ5020 DLSZE=34:REM Display List sizeõ5030 LINELEN=160:REM Horizontal length of scrolling windowõ5040 SCRNSZE=6*24+LINELEN*6:REM Screen sizeõ5050 MEM=DLSZE+SCRNSZE:REM MEMory to reserve for DL and Screenõ5060 RESTORE :READ OBJSõ5070 DIM FRMDATA(OBJS,3):DIM FRAMES(OBJS),FRMSIZE(OBJS),NUMPLRS(OBJS),PLRFRMMEM(OBJS),FRMLSTSIZE(OBJS)õ5080 FOR I=1 TO OBJSõ5090   READ TEMP1,TEMP2,TEMP3õ5100   FRAMES(I)=TEMP1:FRMSIZE(I)=TEMP2:NUMPLRS(I)=TEMP3õ5110   PLRFRMMEM(I)=FRAMES(I)*FRMSIZE(I)+1õ5120   FRAMEMEM=FRAMEMEM+PLRFRMMEM(I)*NUMPLRS(I)õ5130   FRMLSTSIZE(I)=FRAMES(I)+3õ5140   TOTFRMLSTSIZE=TOTFRMLSTSIZE+FRMLSTSIZE(I)*NUMPLRS(I)õ5150 NEXT Iõ5160 DIM BUFFER$(128),FRAMEMEM$(FRAMEMEM),FRMLSTMEM$(TOTFRMLSTSIZE)õ5170 DIF=DIF+4:IF DIF*256<MEM THEN 5170õ5180 HIBASE=PEEK(106)-DIF:REM Find DL Hi and Lo bytesõ5190 LOBASE=0õ5200 DLBASE=HIBASE*256+LOBASEõ5210 SCRN=DLBASE+DLSZE:REM Starting address of Screen RAMõ5220 X=SCRN:GOSUB 110õ5230 SCRNHI=HIBYTE:SCRNLO=LOBYTE:REM Find Screen Hi and Lo bytesõ5240 SCRLWIN=SCRN+48:REM Beginning of Scroll windowõ5250 SCROLL=ADR(SCROLL$)õ5260 DLIROUT=ADR(DLIROUT$)õ5270 PMOVER=ADR(PMOVER$)õ5280 ANIMATE=ADR(ANIMATE$)õ5290 AUTOMOVE=ADR(AUTOMOVE$)õ5300 MFILL=ADR(MFILL$)õ5310 BUFFER=ADR(BUFFER$)õ5320 PLRFRAMES=ADR(FRAMEMEM$)õ5330 FRMLSTMEM=ADR(FRMLSTMEM$)õ5340 RETURN õ5350 REM õ6000 REM ”ÂÙ†’†ÙËÂ†ƒÈÛÏ·˘†ÃÈÛÙõ6010 GRAPHICS 2+16:REM Set flags to Graphics mode 2õ6020 POKE 559,0:REM Turn off screen DMAõ6030 POKE DLBASE,112:REM Set up top border, 24 scan linesõ6040 POKE DLBASE+1,112õ6050 POKE DLBASE+2,112õ6060 POKE DLBASE+3,71:REM LMS for line 1õ6070 POKE DLBASE+4,SCRNLOõ6080 POKE DLBASE+5,SCRNHIõ6090 POKE DLBASE+6,7+128:REM Line 2 (w/ DLI)õ6100 FOR I=0 TO 6:REM Loop for lines 3-9õ6110   WINDOW=SCRLWIN+I*LINELENõ6120   BYTE=87:REM LMS and HSCRLõ6130   IF I=2 OR I=5 THEN BYTE=87+128:REM DLI, LMS and HSCRL for lines 5 and 8õ6140   IF I=6 THEN BYTE=71:REM No scroll for line 9õ6150   POKE DLBASE+7+3*I,BYTE:REM LMS and HSCRLõ6160   X=WINDOW:GOSUB 110õ6170   POKE DLBASE+8+3*I,LOBYTEõ6180   POKE DLBASE+9+3*I,HIBYTEõ6190 NEXT Iõ6200 POKE DLBASE+28,7+128:REM Last 3 linesõ6210 POKE DLBASE+29,7õ6220 POKE DLBASE+30,7+128õ6230 POKE DLBASE+31,65:REM Jump on VBLANK to beginning of DLõ6240 POKE DLBASE+32,LOBASEõ6250 POKE DLBASE+33,HIBASEõ6260 X=DLIROUT:GOSUB 110õ6270 POKE 512,LOBYTE:REM Address of DL for DLI handling routineõ6280 POKE 513,HIBYTEõ6290 REM Tell ANTIC where the DL isõ6300 POKE 560,LOBASEõ6310 POKE 561,HIBASEõ6320 SETCOLOR 0,15,4:SETCOLOR 1,12,4:SETCOLOR 2,0,10:SETCOLOR 3,0,12:SETCOLOR 4,9,8:REM Brn, grn, wht, wht, blueõ6330 RETURN õ6340 REM õ7000 REM …ÓÈÙÈ·ÏÈ˙Â†–Ï·˘ÂÚ≠ÕÈÛÛÈÏÂ†«Ú·ËÈ„Ûõ7010 TEMP=PEEK(106)-DIF-4:REM Set aside Player-Missile areaõ7020 POKE 54279,TEMP:REM Tell ANTIC where PM RAM isõ7030 PMBASE=256*TEMP:REM Find PM Base addressõ7040 FOR I=0 TO 3õ7050   PLR(I)=PMBASE+128*I+512:REM Set addresses of Playersõ7060   PMWIDTH(I)=53256+I:REM Set addresses of Player Widthsõ7070 NEXT Iõ7090 POKE 623,1:REM Set priority - Players in frontõ7100 POKE 53277,2:REM Enable Player displayõ7110 TEMP=USR(MFILL,PLR(0),512,0):REM Use memory fill routine to clear Playersõ7120 RETURN õ7130 REM õ8000 REM ”ÂÙ†’†¡ÏÙÂÚÓ·ÙÂ†√Ë·Ú·„ÙÂÚ†”ÂÙõ8010 HICHRB=PEEK(106)-DIF-4:REM Reserve space (512 bytes)õ8020 CHRBAS=HICHRB*256:REM Find start of Character Setõ8030 REM Read in data, skip first 28 charactersõ8040 OFFSET=28*8:CHARS=35õ8050 RESTORE 23000õ8060 READ TOTAL:TEMP=0õ8070 FOR I=CHRBAS+OFFSET TO CHRBAS+OFFSET+CHARS*8-1õ8080   READ BYTE:POKE I,BYTE:TEMP=TEMP+BYTEõ8090 NEXT Iõ8100 IF TOTAL<>TEMP THEN GRAPHICS 0:PRINT "≈““œ“ In Character Set Data":END õ8110 REM Clear out first char (background)õ8120 FOR I=CHRBAS TO CHRBAS+7õ8130   POKE I,0õ8140 NEXT Iõ8150 RETURN õ8160 REM õ10000 REM “Â·‰†ÈÓ†∆Ú·ÌÂ†ƒ·Ù·õ10010 OFFSET=0:OFFSET2=0:DIM FRAMELIST(OBJS):RESTORE 21000õ10020 FOR K=1 TO OBJSõ10030   FRAMELIST(K)=FRMLSTMEM+OFFSETõ10040   OFFSET=OFFSET+(FRAMES(K)+3)*NUMPLRS(K)õ10050   FOR I=0 TO NUMPLRS(K)-1õ10060     FRMDATA(K,I)=PLRFRAMES+OFFSET2:REM Store addresses of frame dataõ10070     OFFSET2=OFFSET2+PLRFRMMEM(K)õ10080     POKE FRMDATA(K,I),FRMSIZE(K):REM Poke Frame size at beginning of each set of frame dataõ10090     FOR J=1 TO PLRFRMMEM(K)-1õ10100       READ BYTEõ10110       POKE FRMDATA(K,I)+J,BYTEõ10120     NEXT J:NEXT I:NEXT Kõ10130 RETURN õ10140 REM õ10995 REM õ11000 REM …Œ…‘…¡Ã…⁄≈†“œ’‘…Œ≈†”‘“…Œ«”õ11010 REM ”ÂÙ†”√“œÃÃ†ÚÔıÙÈÓÂõ11020 DIM SCROLL$(316)õ11030 SCROLL$(1)="∏PLb‰ÿ≠˜H•‡çY•·çZ≠0Ö‡≠1Ö·≠çP©¿çQ≠† NPêJNQ»–ÙçP≠-mFÕê∞P≠–YÓP"õ11040 SCROLL$(91)="-çFMç‘≠PmDçDêÓE≠D8mQçDêÓE≠EÕê(–≠DÕê© çDçEçP≠çB≠çC∏P–gP"õ11050 SCROLL$(181)="ü≠DÌQçD∞ŒE≠BmPçBçRêÓC≠CçS†±‡…A))P )»≠Rë‡mçR»≠Së‡mçS≠»»»–”P¶≠"õ11060 SCROLL$(271)="YÖ‡≠ZÖ·∏Pô©Äç≠çF© çDçE≠çB≠çC∏Pœ"õ11100 REM ”ÂÙ†ƒÃ…†ÚÔıÙÈÓÂ†õ11110 DIM DLIROUT$(94)õ11120 DLIROUT$(1)="∏P
Lb‰© çKˆHäHòH•‡ç]•·ç^≠$Ö‡≠%Ö·¨K±‡H»±‡™»±‡»åK®hÍÍÍÍÍÍÍÍÍç
‘ç–é–å–≠]Ö‡≠^Ö·h®"õ11130 DLIROUT$(91)="h™h@"õ11200 REM “Â·‰†√ÔÏÔÚ†÷·ÏıÂÛ†…ÓÙÔ†ƒÃ…†‘·‚ÏÂõ11210 DLITBLSZE=15:RESTORE 25510õ11220 DIM DLITABLE$(DLITBLSZE)õ11230 DLITABLE=ADR(DLITABLE$)õ11240 FOR I=0 TO DLITBLSZE-1õ11250   READ BYTEõ11260   POKE DLITABLE+I,BYTEõ11270 NEXT Iõ11300 REM ”ÂÙ†–Õœ÷≈“†ÚÔıÙÈÓÂõ11310 DIM PMOVER$(186)õ11320 PMOVER$(1)="∏PLb‰¢Ω&ù – ˜0¢µﬂùS –¯hhhÖ„•„Ö‚¨¢ éF‚êΩù&Ë‡–Òå¢ Ü‡≠ Ö·≠Ö‰≠ÖÂ≠Ö‚é"õ11330 PMOVER$(91)="F„∞•‡IÄÖ‡–Ê·Ë‡–Ì•‚çËΩTï‡ ¯`†±‡ë‰à˘éLΩ*HΩ
ù*®h™éMåNä®±‰¨Në‡»† Ë¢ ÏM–Â"õ11340 PMOVER$(181)="ÆL∏P•"õ11400 REM ”ÂÙ†¡Œ…Õ¡‘≈†ÚÔıÙÈÓÂõ11410 DIM ANIMATE$(294)õ11420 ANIMATE$(1)="∏PLb‰ÿ¢µ‡ùY ¯≠Ì0H


çP¢ N∞ê⁄Ë‡–Ú©Äç–+Ω–©ˇù.ä
®πô2πô3≠P0÷Ωù:©"õ11430 ANIMATE$(91)="ù>–…© Ö‡≠ Ö·¢ Ω.	…ˇ%ﬁ:•‡IÄÖ‡–Ê·Ë‡–„ΩXïﬂ –¯ïΩ.…ˇ–©ù:ä
®π2Ö‚π3Ö„˛>Ω>®±‚"õ11440 ANIMATE$(181)="–	©ù>–ÙP∫çPŒP† ±‚H»±‚Ö„hÖ‚à±‚çQ© †NPêmQJnRà–®≠R8e‚Ö‚òe„Ö„éPΩ*®¢ åRä®±‚¨Rë"õ11450 ANIMATE$(271)="‡»ËÏQ–ÌÆPΩ.…ˇ–˛.∏Pó"õ11500 REM ”ÂÙ†¡’‘œÕœ÷≈†ÚÔıÙÈÓÂõ11510 DIM AUTOMOVE$(74)õ11520 AUTOMOVE$(1)="∏PLb‰ÿ≠˜0¢ NêΩ ùGË‡–©Äç¢ΩGIÄ}&ê(0(©ÄùG© ù& ﬂ0π"õ11600 REM ”ÂÙ†Õ∆…ÃÃ†ÚÔıÙÈÓÂõ11610 DIM MFILL$(41)õ11620 MFILL$(1)="hhÖÃhÖÀhÖŒhÖÕhh† ™äëÀ»–ÊÃ•Õ–∆Œ∆Õ•ÕŒ–Í`"õ11650 RETURN õ11655 REM õ11660 REM õ12000 REM ”ÂÙ†–·Ú·ÌÂÙÂÚÛ†∆ÔÚ†“ÔıÙÈÓÂÛõ12010 PARAMBASE=1024:REM Parameter Base addressõ12020 PMBAS=PARAMBASE:REM Hi Byte of PLR0 Location goes hereõ12030 PMBUF=PARAMBASE+1:REM Address of a 128 byte bufferõ12040 INITANIMATE=PARAMBASE+3:REM Initialize Frame Animate routineõ12050 INITAUTOMOVE=PARAMBASE+4:REM Initialize Player Automove routineõ12060 SCRLINIT=PARAMBASE+5:REM Poke a 1 to initialize the scroll routineõ12070 FOR I=0 TO 3õ12080   HPLR(I)=PARAMBASE+6+I:REM Player horizontal "shadow" registersõ12090   VPLR(I)=PARAMBASE+10+I:REM Player vertical "shadow" registersõ12100   RATE(I)=PARAMBASE+14+I:REM Animate rate "shadow" registersõ12110   FRMLSTPTR(I)=PARAMBASE+18+I*2:REM Pointer to Frame Listsõ12120   MOVERATE(I)=PARAMBASE+32+I:REM Horizontal movement for AUTOMOVEõ12130 NEXT Iõ12140 SCRLADR=PARAMBASE+26:REM Address of scrolling windowõ12150 SCRLLEN=PARAMBASE+28:REM Line length of scrolling windowõ12160 SCRLCLK=PARAMBASE+30:REM Number of Color Clocks per screen byteõ12170 SCRLSTEP=PARAMBASE+31:REM Step size of scroll each jiffyõ12180 DLIADR=PARAMBASE+36:REM Address of DLI tableõ12190 VVBLKD=548:REM Deferred Vertical Blank Interrupt Vectorõ12200 CRITICAL=66:REM Critical Flagõ12210 P0=1:P1=2:P2=4:P3=8:REM Control bits for the four Playersõ12220 FST2P=P0+P1õ12230 LST2P=P2+P3:ALLP=P0+P1+P2+P3õ12240 TEMP=USR(MFILL,PARAMBASE,94,0):REM IMPORTANT: Clear out parameter areaõ12250 X=PLR(0):GOSUB 110:POKE PMBAS,HIBYTE:REM Poke Hi Byte of Player 0 into PMBASõ12260 X=BUFFER:GOSUB 110:POKE PMBUF,LOBYTE:REM Poke address of bufferõ12270 POKE PMBUF+1,HIBYTEõ12280 X=SCRLWIN:GOSUB 110õ12290 POKE SCRLADR,LOBYTEõ12300 POKE SCRLADR+1,HIBYTEõ12320 X=LINELEN:GOSUB 110õ12330 POKE SCRLLEN,LOBYTEõ12340 POKE SCRLLEN+1,HIBYTEõ12350 POKE SCRLCLK,7:REM Set to 8 color clocks per byteõ12360 X=DLITABLE:GOSUB 110õ12370 POKE DLIADR,LOBYTEõ12380 POKE DLIADR+1,HIBYTEõ12390 REM õ12400 REM ”ÂÙ†’†∆Ú·ÌÂ†ÃÈÛÙÛõ12410 DIM POINTER(OBJS,1)õ12420 FOR K=1 TO OBJSõ12430   FOR I=0 TO NUMPLRS(K)-1õ12440     LET POINTER(K,I)=FRAMELIST(K)+I*FRMLSTSIZE(K):REM Points to start of each Frame Listõ12450     X=FRMDATA(K,I):GOSUB 110õ12460     POKE POINTER(K,I),LOBYTE:REM Put in address of Frame Dataõ12470     POKE POINTER(K,I)+1,HIBYTEõ12480     FOR J=1 TO FRAMES(K):REM Make up a Frame List (numbers 1 thru FRAMES)õ12490       POKE POINTER(K,I)+J+1,Jõ12500     NEXT Jõ12510     POKE POINTER(K,I)+FRAMES(K)+2,0:REM End of frame list markerõ12520   NEXT I:NEXT Kõ12530 RETURN õ12540 REM õ13000 REM …ÓÛÙ·ÏÏ†…ÓÙÂÚÚıÙ†“ÔıÙÈÓÂÛõ13010 POKE CRITICAL,1:REM Open CRITICAL "valve", set up detourõ13020 X=SCROLL+6:GOSUB 110õ13030 POKE VVBLKD,LOBYTE:REM Set VBLANK vector to SCROLLõ13040 POKE VVBLKD+1,HIBYTEõ13050 X=DLIROUT+6:GOSUB 110õ13060 POKE SCROLL+4,LOBYTE:REM Points SCROLL to DLIROUTõ13070 POKE SCROLL+5,HIBYTEõ13080 X=PMOVER+6:GOSUB 110õ13090 POKE DLIROUT+4,LOBYTE:REM Points DLIROUT to PMOVERõ13100 POKE DLIROUT+5,HIBYTEõ13110 X=ANIMATE+6:GOSUB 110õ13120 POKE PMOVER+4,LOBYTE:REM Points PMOVER to ANIMATEõ13130 POKE PMOVER+5,HIBYTEõ13140 X=AUTOMOVE+6:GOSUB 110õ13150 POKE ANIMATE+4,LOBYTE:REM Points ANIMATE to AUTOMOVEõ13160 POKE ANIMATE+5,HIBYTEõ13170 POKE CRITICAL,0:REM Close CRITICAL "valve", routines installedõ13180 POKE SCRLINIT,1õ13190 POKE 54286,192:REM Enable DLI'sõ13200 RETURN õ13210 REM õ20000 REM ∆“¡Õ≈†ƒ¡‘¡õ20010 REM Number of objectsõ20020 DATA 5õ20030 REM õ20040 REM Number of Frames, Frame Size, Number of Playersõ20050 REM .  (Walking Man)õ20060 DATA 5,19,2õ20070 REM .  (Tree Trunk)õ20080 DATA 1,52,1õ20090 REM .  (Tree Top)õ20100 DATA 1,26,1õ20110 REM .  (Truck)õ20120 DATA 1,25,2õ20130 REM .  (Car)õ20140 DATA 1,13,2õ20150 REM õ21000 REM ∆Ú·ÌÂ†‰·Ù·†ÊÔÚ†◊·ÏÎÈÓÁ†Õ·Óõ21010 REM Frame 1, Player 0õ21020 DATA 0,0,0,0,0,0,0,3,15,29,59,51,7,7,15,252,224,112,48õ21030 REM Frame 2, Player 0õ21040 DATA 0,0,0,0,0,0,0,1,7,15,31,55,55,7,111,125,248,192,193õ21050 REM Frame 3, Player 0õ21060 DATA 0,0,0,0,0,0,3,7,15,31,31,31,31,222,254,251,231,206,15õ21070 REM Frame 4, Player 0õ21080 DATA 1,3,3,3,1,7,15,31,30,62,62,63,63,60,124,120,112,112,252õ21090 REM Frame 5, Player 0õ21100 DATA 0,0,1,1,1,0,7,31,31,31,31,31,15,15,13,31,123,112,124õ21110 REM Frame 1, Player 1õ21120 DATA 0,28,62,62,62,28,240,240,240,240,251,255,220,192,192,227,118,60,24õ21130 REM Frame 2, Player 1õ21140 DATA 0,0,56,124,124,124,56,224,224,224,224,246,254,192,128,192,224,224,248õ21150 REM Frame 3, Player 1õ21160 DATA 0,112,248,248,248,112,192,192,128,128,128,224,224,0,0,0,0,0,128õ21170 REM Frame 4, Player 1õ21180 DATA 192,224,224,224,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0õ21190 REM Frame 5, Player 1õ21200 DATA 0,224,240,240,240,224,128,128,128,128,176,240,0,128,192,128,192,0,0õ21210 REM õ22000 REM ∆Ú·ÌÂ†‰·Ù·†ÊÔÚ†‘ÚÂÂõ22010 REM Player 2, Tree Trunkõ22020 DATA 2,2,132,128,64,0,149,165,210,211,219,251,255,254,126,126,126,126,126,126õ22030 DATA 126,126,126,126,126,126,126,126,126,122,126,126,126,126,126,126,126,126,126,126õ22040 DATA 126,126,126,126,126,126,126,126,255,255,219,137õ22050 REM Player 3, Tree Topõ22060 DATA 24,24,60,60,126,126,126,255,255,255,255,255,255,255,255,255,255,255,255,126õ22070 DATA 126,60,60,60,24,24õ22080 REM õ22100 REM ∆Ú·ÌÂ†‰·Ù·†ÊÔÚ†‘Úı„Îõ22110 REM Player 2, Truck Cabõ22120 DATA 0,0,0,0,0,15,25,17,17,17,17,17,31,31,255,255,255,255,255,255õ22130 DATA 255,255,255,28,28õ22140 REM Player 3, Truck Bodyõ22150 DATA 255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255õ22160 DATA 255,255,255,12,12õ22170 REM õ22200 REM ∆Ú·ÌÂ†‰·Ù·†ÊÔÚ†√·Úõ22210 REM Player 2, Car backõ22220 DATA 7,9,17,17,17,31,63,127,255,255,255,56,16õ22230 REM Player 3, Car frontõ22240 DATA 192,64,32,32,16,248,255,255,255,254,255,28,8õ23000 REM √Ë·Ú·„ÙÂÚ†”ÂÙ†ƒ·Ù·õ23010 DATA 38646õ23020 DATA 0,3,15,31,63,63,127,127õ23030 DATA 0,192,240,248,252,252,254,254õ23040 DATA 127,127,127,63,63,31,15,7õ23050 DATA 254,254,254,252,252,248,240,224õ23060 DATA 4,31,4,31,4,4,4,4õ23070 DATA 48,48,48,63,54,54,54,54õ23080 DATA 3,3,3,3,3,3,3,3õ23090 DATA 255,195,219,219,219,219,219,219õ23100 DATA 12,12,12,252,108,108,108,108õ23110 DATA 0,0,0,252,108,108,108,108õ23120 DATA 127,127,127,127,127,127,127,127õ23130 DATA 254,254,254,254,254,254,254,254õ23140 DATA 1,3,7,15,31,63,127,255õ23150 DATA 1,1,3,3,7,7,15,15õ23160 DATA 128,192,224,240,248,252,254,255õ23170 DATA 3,3,7,7,15,0,0,0õ23180 DATA 192,192,224,224,240,0,0,0õ23190 DATA 156,220,252,252,252,252,254,255õ23200 DATA 128,128,192,192,224,224,243,243õ23210 DATA 128,128,192,192,224,224,240,240õ23220 DATA 255,255,39,39,255,39,39,255õ23230 DATA 0,0,0,63,54,54,54,54õ23240 DATA 255,255,228,228,255,228,228,255õ23250 DATA 255,24,24,24,255,24,24,24õ23260 DATA 255,255,255,255,255,255,255,255õ23270 DATA 251,251,255,252,254,254,255,255õ23280 DATA 192,192,192,192,192,192,192,192õ23290 DATA 0,0,0,255,102,102,102,102õ23300 DATA 248,248,252,252,254,254,255,255õ23310 DATA 57,59,63,63,63,63,127,255õ23320 DATA 31,31,63,63,127,127,255,255õ23330 DATA 127,127,127,127,63,63,30,0õ23340 DATA 255,255,255,255,255,254,124,0õ23350 DATA 254,254,254,254,252,252,120,0õ23360 DATA 255,255,255,0,0,0,0,0õ23370 REM õ25500 REM ƒÃ…†√ÔÏÔÚ†÷·ÏıÂÛõ25510 DATA 234,90,152,234,90,198,10,0,198,0,0,6,0,0,10õ