0100     .OPT NO LIST
0110 ; GRAPHICS CURSOR HANDLER
0120 ; VERSION 3.2
0130 ;
0140 ; GLOBAL EQUATES
0150 YPOS =  $54
0160 XPOS =  $55
0170 COLOR = $C8
0180 PLOTMODE = $0600
0190 TEXTUREF = $0601
0200 CHARDEF = $0602
0210 YNEW =  $0610
0220 XNEW =  $0611
0230 STRIG = $061E
0240 MAPCH = $AD00
0250 PLAYER1 = $6C00
0260 DRAW =  $A700
0270 MAPDRAW = $AD60
0280 FILL =  $A800
0290 ;
0300 ; LOCAL EQUATES
0310 ZVEC =  $66
0320 PENY =  $0613
0330 PENX =  $0614
0340 YORIGIN = $0615
0350 XORIGIN = $0616
0360 LINEMODE = $0617
0370 PLOTFLAG = $0618
0380 LINEFLAG = $0619
0390 LINECHRFLAG = $061A
0400 CONNECTFLAG = $061B
0410 RAYFLAG = $061C
0420 FILLFLAG = $061D
0430 ;
0440 ;
0450 ;
0460     *=  $AE00
0470     CLD 
0480     LDX #0
0490     TXA 
0500 CLRPLR1
0510     STA PLAYER1,X
0520     INX 
0530     BNE CLRPLR1
0540     STX $D4
0550     STX $D5
0560     STX LINEMODE
0570     JMP MOVEPEN
0580 START
0590     LDX $14
0600     INX 
0610 WAIT
0620     CPX $14
0630     BNE WAIT
0640     LDA $D300
0650     AND #$0F
0660     CMP #$0F
0670     BNE MOVEPEN
0680     LDA STRIG
0690     BEQ MOVEPEN
0700     LDA $02FC
0710     CMP #$40
0720     BCS CHECKF
0730     LDA #$FF
0740     STA $D4
0750     JMP CHECK.LINE1
0760 CHECKF
0770     LDA #8
0780     STA $D01F
0790     LDA $D01F
0800     CMP #7
0810     BEQ CHECKX
0820     STA $D4
0830     JMP CHECK.LINE1
0840 CHECKX
0850     TXA 
0860     AND #1
0870     BNE STOREX1
0880     LDA PENX
0890     CLC 
0900     ADC #45
0910 STOREX1
0920     STA $D000
0930     JMP START
0940 MOVEPEN
0950 CHECK.LINE1
0960     LDA LINEMODE
0970     BEQ NO.LINE
0980     JSR DOLINE  ; ERASE OLD
0990 NO.LINE
1000     LDA $D4
1010     BEQ CLRPEN
1020     LDA PENX
1030     CLC 
1040     ADC #45
1050     STA $D000
1060     LDA #0
1070     STA LINEMODE
1075     STA LINEFLAG
1080     RTS         ; TO BASIC
1090 CLRPEN
1100     LDA PENY
1110     CLC 
1120     ADC #27
1130     TAY 
1140     LDX #$0E
1150     LDA #0
1160 CLRCRS
1170     STA PLAYER1,Y
1180     INY 
1190     DEX 
1200     BNE CLRCRS
1210     LDA $D300
1220     TAY 
1230     LSR A
1240     LSR A
1250     AND #3
1260     TAX 
1270     LDA PENX
1280     CLC 
1290     ADC INCTAB,X
1300     CMP #160
1310     BCS DO.Y
1320     STA PENX
1330 DO.Y
1340     TYA 
1350     AND #3
1360     TAY 
1370     LDA PENY
1380     CLC 
1390     ADC INCTAB,Y
1400     CMP #192
1410     BCS STOREPOSX
1420     STA PENY
1430 STOREPOSX
1440     LDX PENX
1450     LDA $14
1460     AND #1
1470     BEQ NO.ERASE
1480     LDX #$E8
1490 NO.ERASE
1500     TXA 
1510     CLC 
1520     ADC #45
1530     STA $D000
1540     LDA PENY
1550     CLC 
1560     ADC #29
1570     TAX 
1580     LDY #0
1590     LDA CHARDEF
1600     STA ZVEC
1610     LDA CHARDEF+1
1620     STA ZVEC+1
1630 STORECRS
1640     LDA (ZVEC),Y
1650     STA PLAYER1,X
1660     INX 
1670     INY 
1680     CPY #8
1690     BCC STORECRS
1700     LDA STRIG
1710     BEQ DO.PLOT
1720     JMP END
1730 DO.PLOT
1740     LDA PLOTFLAG
1750     BEQ CHECK.LINE
1760     LDA #0
1770     STA PLOTMODE
1780     LDX PENX
1790     LDY PENY
1800     STX XPOS
1810     STY YPOS
1820     JSR MAPCH
1830     JMP END
1840 CHECK.LINE
1850     LDA LINEFLAG
1860     BEQ CHECK.FILL
1870     LDA #0
1880     STA PLOTMODE
1890     STA LINEMODE
1900     STA LINEFLAG
1910     LDX XORIGIN
1920     LDY YORIGIN
1930     STX XPOS
1940     STY YPOS
1950     LDX PENX
1960     LDY PENY
1970     STX XNEW
1980     STY YNEW
1990     LDA LINECHRFLAG
2000     BEQ DO.DRAW
2010     JSR MAPDRAW
2020     JMP CHECK.CONNECT
2030 DO.DRAW
2040     JSR DRAW
2050 CHECK.CONNECT
2060     LDA CONNECTFLAG
2070     BEQ CHECK.RAY
2080     LDA #1
2090     STA LINEMODE
2100     STA LINEFLAG
2110     LDX PENX
2120     LDY PENY
2130     STX XORIGIN
2140     STY YORIGIN
2150     JMP WAIT.REL
2160 CHECK.RAY
2170     LDA RAYFLAG
2180     BEQ WAIT.REL
2190     STA LINEFLAG
2200     STA LINEMODE
2210     JMP END
2220 CHECK.FILL
2230     LDA FILLFLAG
2240     BEQ START.LINE
2250     LDA #0
2260     STA PLOTMODE
2270     LDX PENX
2280     LDY PENY
2290     STX XPOS
2300     STY YPOS
2310     JSR FILL
2320     JMP WAIT.REL
2330 START.LINE
2340     LDA #1
2350     STA LINEFLAG
2360     STA LINEMODE
2370     LDX PENX
2380     LDY PENY
2390     STX XORIGIN
2400     STY YORIGIN
2410 WAIT.REL
2420     LDA STRIG
2430     BEQ WAIT.REL
2440 END
2450     LDA #0
2460     STA $D4
2470     STA $D5
2480     LDA LINEMODE
2490     BNE DRLINE
2500     JMP START
2510 DRLINE
2520     JSR DOLINE
2530     JMP START
2540 DOLINE
2550     LDX XORIGIN
2560     LDY YORIGIN
2570     STX XPOS
2580     STY YPOS
2590     LDX PENX
2600     LDY PENY
2610     STX XNEW
2620     STY YNEW
2630     LDA #1
2640     STA PLOTMODE
2650     LDA TEXTUREF
2660     PHA 
2670     LDA COLOR
2680     PHA 
2690     LDA #0
2700     STA TEXTUREF
2710     LDA #3
2720     STA COLOR
2730     JSR DRAW
2740     PLA 
2750     STA COLOR
2760     PLA 
2770     STA TEXTUREF
2780     RTS 
2790 INCTAB
2800     .BYTE 0,1,$FF,0
